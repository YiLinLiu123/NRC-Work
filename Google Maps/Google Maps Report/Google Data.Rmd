---
title: "Google Data Extraction"
author: "paul"
date: "March 8, 2017"
output: html_document:
        toc: true
        toc.depth: 4
---

```{r googleDataSetup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### Overview:
*   The [Google Web Services API](https://developers.google.com/maps/web-services/overview) is divided into multiple subsequent APIs each responsible for offering unique features.
    +   _Directions:_ calculates directions between locations in an optimized manner.
    +   _Distance Matrix:_ provides travel distance and time for origin and destination pairs.
    +   _Elevation:_ provides elevation data for points. 
    +   _Geocoding:_ provides geocoding and reverse geocoding. From address to lat/lng pairs 
        and vice versa.
    +   _Roads:_ snaps points of travel to closest road, speed limits, tracking(only for premium).
    +   _Time Zone:_ provides time zone information about a location.
    +   _Places:_ Extracts and returns points of interest around a center.

*   __Please refer to the developer documentation for each webservice API under the _"developer's guide"_ option. Google does an amazing job explaining
      the full functionality of each webservice and provides ample examples.__
    +   Interesting features often includes _biasing_ of search results to favor conditions met by parameters.
    +   It is relatively easy to extract information for a list of points by seperating via _"|"_ or _","_.

*   All API requests can be made using a __HTTP GET__ request.
    +   Example format: `https:maps.googleapis.com/maps/api/{API Service Name}/{return format: json or xml}/{query}`
    +   Example request example: 
        `https://maps.googleapis.com/maps/api/directions/json?origin=Disneyland&destination=Universal+Studios+Hollywood4&key=YOUR_API_KEY`

*   An access key is required and there are quotas restricting access. 

*   An [premium account](https://developers.google.com/maps/premium/usage-limits) is available for purchase 
    which allows access to more functionality and more quota. 
    However, the free access keys are sufficient for most purposes.

*   Similar to other APIs, each object in Google Maps also includes its own Id and this Id 
    is often used to request more detailed information via _/detail/_ feature compared
    to just using the name of the object.


*****


###  Creating Access Key:  



#### Test Email Account Information:

*   _Name:_   API-Testing(first name) NRC(last name)
*   _Username/Email:_   NRC.API.Testing@gmail.com
*   _Password:_   NRCTesting123
*   _Birthday:_   July 1st 1997
*   _Gender_: Rather  not say    

        
        
#### Steps to Create Key:
1:  Log into the [Google API Console](https://console.developers.google.com).   

2:  In the top menu bar, click create "new project".  

![](./Pictures/Create_New_Project.jpg)  

3:  Enable the following permissions under the _"dashboard"_.  

![](./Pictures/Enable_API.jpg)  

4:  On the left menu, select _Credentials_ and click _Create Credentials_. 
    The information under the _key_ is the credential used to access the maps api.  
    
![](./Pictures/Create_Key.jpg)


*****

### Rate Limit:
*   [Rate Limit Table](https://enterprise.google.com/maps/pricing/?utm_source=google&utm_medium=cpc&utm_campaign=2016-geo-na-endor-gmedia-search-us-br_bmm_en_refr_hv_price&utm_content=usca%7Cen%7Chybr%7C1001877%7C%7C%7Cbrand%7C%7Crefr_hv_price&utm_term=%2Bgoogle%20%2Bmap%20%2Bapi%20%2Bplans&creative=153855030923&gclid=Cj0KEQiA9P7FBRCtoO33_LGUtPQBEiQAU_tBgK-i1qyj1UvAJCLTGFzlZHbBPsgGs0l6T4mZBUbCka4aAsHz8P8HAQ#compare-editions)

*   Can make up to 2500 requets per day with a limit of 50 requests per second (may vary). 

*   Can make up to 150,000 free _place webservice_ calls after credit card validation.

*   __The rate limit information for each webservice is also specified under its developer documentation.__

*   The dashboard under the google API console provides the usage information for your application.

*****

### Sample Queries and Extracting Data:
*   It is recommanded to first test out the query in a web browser 
*   The main packages used are as follows and are available for download on CRAN through _install.packages_:
    +   [httr](https://cran.r-project.org/web/packages/httr/vignettes/quickstart.html) to make HTTP requests.
        +   [httr documentation](https://cran.r-project.org/web/packages/httr/httr.pdf)
    +   [jsonlite](https://cran.r-project.org/web/packages/jsonlite/vignettes/json-aaquickstart.html) to parse JSON data.

```{r data_Libraries, results ="hide"}
    library(httr);
    library(jsonlite);
    
```


```{r data_RequestExample}
    key = "AIzaSyBGTs-gZCbyP8n0Hvw_VZ76Z6YrST1DNa8"
    host = "https://maps.googleapis.com/maps/api"
    
    ## Extracting location information about NRC library in Ottawa
    request1 = paste(host,"/geocode/json", "?address=NRC+National+Science+Library&key="
                     ,key,sep="")
    
    raw1 = GET(request1)
    
    
    ## Note the actual response data is located under the content information 
    ## and that the content is in raw format.
    names(raw1)
    
    ##  Parsing into JSON nested lists/data frames
    response = jsonlite::fromJSON(content(raw1,"text"))
    paste("formatted address",response$results$formatted_address,sep=" ");

    ##  Then the data needs to be parsed,which will not be shown. It is recommanded to use 
    ##  the str() function to investigate nesting.
    

```


###  First Thoughts:
*   Google Maps API does an amazing job reporting geographical location and makes it easy to access the data. The main diffculty will be parsing the JSON/XML response from the sever. 

*   It is recommanded to use Google Maps API to supplment existing geographical data to perform analysis. It will be more useful to use google Maps to provide visualizations within R. 


*****


### Next Steps:
*   More time will be spent exploring other packages that provides calculation and spatial analysis techniques.